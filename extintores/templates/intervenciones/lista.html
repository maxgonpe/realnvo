{% extends 'base.html' %}

{% block content %}
<h4 class="mb-3">Hola {{ user.username }} 游녦</h4>
<form method="post" action="{% url 'logout' %}" class="mb-3">
    {% csrf_token %}
    <button type="submit" class="btn btn-outline-danger btn-sm">
        <i class="bi bi-box-arrow-right"></i> Cerrar sesi칩n
    </button>
</form>

<!-- Pesta침as -->
<ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="servicios-tab" data-bs-toggle="tab" data-bs-target="#servicios" type="button" role="tab">
            <i class="bi bi-tools"></i> Servicios
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="gestion-tab" data-bs-toggle="tab" data-bs-target="#gestion" type="button" role="tab">
            <i class="bi bi-folder"></i> Gesti칩n
        </button>
    </li>
</ul>

<div class="tab-content" id="mainTabsContent">
    <!-- Pesta침a Servicios -->
    <div class="tab-pane fade show active" id="servicios" role="tabpanel">
        <div class="d-flex flex-wrap gap-2 mb-3 mt-3">
            <a href="{% url 'intervencion_crear' %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Nuevo Servicio
            </a>
        </div>

        <input type="text" id="searchInput" class="form-control mb-3" placeholder="游댌 Buscar por cliente, t칠cnico o tipo...">

        <div id="intervenciones-container">
            {% include 'intervenciones/partials/intervenciones_list.html' %}
        </div>
    </div>

    <!-- Pesta침a Gesti칩n -->
    <div class="tab-pane fade" id="gestion" role="tabpanel">
        <div class="d-flex flex-wrap gap-2 mt-3">
            <a href="{% url 'lista_clientes' %}" class="btn btn-outline-primary">
                <i class="bi bi-people"></i> Clientes
            </a>
            <a href="{% url 'lista_productos' %}" class="btn btn-outline-primary">
                <i class="bi bi-box-seam"></i> Productos
            </a>
            <a href="{% url 'odt_lista' %}" class="btn btn-outline-success">
                <i class="bi bi-file-earmark-text"></i> ODT
            </a>
            <a href="{% url 'alertas' %}" class="btn btn-outline-warning">
                <i class="bi bi-bell"></i> Alertas
            </a>
        </div>
    </div>
</div>

<script>
document.getElementById('searchInput').addEventListener('input', function() {
    const query = this.value;
    fetch(`{% url 'ajax_intervenciones' %}?q=${query}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('intervenciones-container').innerHTML = data.html;
        });
});
</script>
{% endblock %}

